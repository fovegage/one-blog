{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}{{ block.super }}
    <script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
    <script>
        django.jQuery(function () {
            var select = django.jQuery("#id_type");
            console.log(select);
            select.change(function () {
                var index = django.jQuery(this).val();
                {#django.jQuery(this).get(index).innerHTML#}
                btype = encodeURI($("#id_type").find("option:selected").text());
                {#console.log("value change"+django.jQuery(this).value());#}
                var curl = "/category/" + btype;//能够正确的访问到view的url
                var turl = "/tag/" + btype;
                {#+django.jQuery(this).get(index).text()#}
                {#                console.log(url);#}
                django.jQuery.get(
                    curl,
                    function (data) {
                        var target = django.jQuery("#id_category");
                        target.empty();//先要清空一下
                        data.forEach(function (e) {
                            // 将从view得到的id和db_user名称赋值给db_server的select
                            console.log(e, e.id, e.name);
                            target.append("<option value='" + e.id + "'>" + e.name + "<option>");
                            target.eq(0).attr('selected', 'true');
                        });
                    });
                {#django.jQuery.get(#}
                {#    turl,#}
                {#    function (data) {#}
                {#        var target = django.jQuery("#id_tag_from");#}
                {#        target.empty();//先要清空一下#}
                {#        data.forEach(function (e) {#}
                {#            // 将从view得到的id和db_user名称赋值给db_server的select#}
                {#            console.log(e, e.id, e.name);#}
                {#            target.append("<option value='" + e.id + "'>" + e.name + "<option>");#}
                {#            target.eq(0).attr('selected', 'true');#}
                {#        });#}
                {#    })#}
            });

        });

    </script>
    {#{{ media }}#}
{% endblock %}